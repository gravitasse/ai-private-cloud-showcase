---
- name: macOS detected, skipping platform apps
  debug:
    msg: "Darwin host - skipping Argo CD / ai-apps install"
  when: ansible_os_family == "Darwin"

- name: Install Argo CD (Linux only)
  command: kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
  environment:
    KUBECONFIG: /etc/kubernetes/admin.conf
  when: ansible_os_family != "Darwin"

- name: Create AI namespace (Linux only)
  command: kubectl create ns ai-apps
  environment:
    KUBECONFIG: /etc/kubernetes/admin.conf
  register: ns_ai
  failed_when: ns_ai.rc not in [0,1]
  when: ansible_os_family != "Darwin"
